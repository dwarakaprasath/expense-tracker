<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Expenses">
  <meta name="theme-color" content="#5F8575">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <title>Expense Tracker</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Manrope:wght@400;500;600;700&display=swap');
    
    :root {
      --color-sage: #5F8575;
      --color-sage-light: #7FA292;
      --color-sage-pale: #E8F0ED;
      --color-cream: #FAF8F5;
      --color-charcoal: #2A2A2A;
      --color-charcoal-light: #565656;
      --color-border: #E5E5E5;
      --color-white: #FFFFFF;
      --color-red: #C85A54;
      --color-amber: #D4A574;
      
      --font-display: 'Playfair Display', serif;
      --font-body: 'Manrope', sans-serif;
      
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.12);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: var(--font-body);
      background: linear-gradient(135deg, #FAF8F5 0%, #F0EDE8 100%);
      color: var(--color-charcoal);
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 24px;
    }
    
    /* Loading Spinner */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(250, 248, 245, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--color-sage-pale);
      border-top: 4px solid var(--color-sage);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Connection Status */
    .connection-status {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 100;
      animation: slideInRight 0.4s ease-out;
    }
    
    .connection-status.connected {
      background: #D4EDDA;
      color: #155724;
      border: 1px solid #C3E6CB;
    }
    
    .connection-status.disconnected {
      background: #F8D7DA;
      color: #721C24;
      border: 1px solid #F5C6CB;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    .connected .status-dot {
      background: #28A745;
    }
    
    .disconnected .status-dot {
      background: #DC3545;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    /* Header */
    .header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 48px;
      animation: slideDown 0.6s ease-out;
    }
    
    .header-icon {
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, var(--color-sage) 0%, var(--color-sage-light) 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md);
    }
    
    .header-icon svg {
      width: 28px;
      height: 28px;
      stroke: white;
      stroke-width: 2;
    }
    
    .header-content h1 {
      font-family: var(--font-display);
      font-size: 32px;
      font-weight: 700;
      color: var(--color-charcoal);
      letter-spacing: -0.5px;
    }
    
    .header-content p {
      font-size: 15px;
      color: var(--color-charcoal-light);
      font-weight: 500;
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
      animation: fadeInUp 0.6s ease-out 0.1s both;
    }
    
    .stat-card {
      background: var(--color-white);
      padding: 28px;
      border-radius: 20px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, var(--color-sage), var(--color-sage-light));
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
    }
    
    .stat-card:hover::before {
      transform: scaleX(1);
    }
    
    .stat-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .stat-icon.green {
      background: var(--color-sage-pale);
    }
    
    .stat-icon.amber {
      background: #FFF4E6;
    }
    
    .stat-icon svg {
      width: 20px;
      height: 20px;
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--color-charcoal-light);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-value {
      font-family: var(--font-display);
      font-size: 36px;
      font-weight: 700;
      color: var(--color-charcoal);
      letter-spacing: -1px;
    }
    
    /* Form Card */
    .form-card {
      background: var(--color-white);
      padding: 40px;
      border-radius: 24px;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--color-border);
      margin-bottom: 40px;
      animation: fadeInUp 0.6s ease-out 0.2s both;
    }
    
    .form-card h2 {
      font-family: var(--font-display);
      font-size: 26px;
      font-weight: 700;
      color: var(--color-charcoal);
      margin-bottom: 32px;
      letter-spacing: -0.5px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-bottom: 24px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    
    label {
      font-size: 14px;
      font-weight: 600;
      color: var(--color-charcoal);
      letter-spacing: 0.3px;
    }
    
    input, select {
      padding: 14px 16px;
      border: 2px solid var(--color-border);
      border-radius: 12px;
      font-family: var(--font-body);
      font-size: 15px;
      color: var(--color-charcoal);
      transition: all 0.3s ease;
      background: var(--color-white);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--color-sage);
      box-shadow: 0 0 0 3px rgba(95, 133, 117, 0.1);
    }
    
    input::placeholder {
      color: #B0B0B0;
    }
    
    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%23565656' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      padding-right: 40px;
    }
    
    .tag-input-wrapper {
      position: relative;
    }
    
    .tags-display {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    
    .tag {
      background: var(--color-sage-pale);
      color: var(--color-sage);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      animation: scaleIn 0.2s ease-out;
    }
    
    .tag-remove {
      cursor: pointer;
      font-size: 16px;
      line-height: 1;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    
    .tag-remove:hover {
      opacity: 1;
    }
    
    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      font-family: var(--font-body);
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      letter-spacing: 0.3px;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--color-sage) 0%, var(--color-sage-light) 100%);
      color: white;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn svg {
      width: 18px;
      height: 18px;
    }
    
    /* Download Section */
    .download-section {
      background: var(--color-white);
      padding: 40px;
      border-radius: 24px;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--color-border);
      margin-bottom: 40px;
      animation: fadeInUp 0.6s ease-out 0.3s both;
    }
    
    .download-section h2 {
      font-family: var(--font-display);
      font-size: 26px;
      font-weight: 700;
      color: var(--color-charcoal);
      margin-bottom: 24px;
      letter-spacing: -0.5px;
    }
    
    .date-range {
      display: flex;
      gap: 16px;
      align-items: flex-end;
      flex-wrap: wrap;
    }
    
    .date-input {
      flex: 1;
      min-width: 200px;
    }
    
    .btn-secondary {
      background: var(--color-white);
      color: var(--color-sage);
      border: 2px solid var(--color-sage);
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: var(--color-sage);
      color: white;
    }
    
    /* Expenses List */
    .expenses-section {
      animation: fadeInUp 0.6s ease-out 0.4s both;
    }
    
    .expenses-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .expenses-header h2 {
      font-family: var(--font-display);
      font-size: 26px;
      font-weight: 700;
      color: var(--color-charcoal);
      letter-spacing: -0.5px;
    }
    
    .expense-count {
      background: var(--color-sage-pale);
      color: var(--color-sage);
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
    }
    
    .expenses-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .expense-item {
      background: var(--color-white);
      padding: 24px 28px;
      border-radius: 16px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      animation: slideInLeft 0.4s ease-out;
      position: relative;
      overflow: hidden;
    }
    
    .expense-item::after {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: linear-gradient(180deg, var(--color-sage), var(--color-sage-light));
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }
    
    .expense-item:hover {
      transform: translateX(4px);
      box-shadow: var(--shadow-md);
    }
    
    .expense-item:hover::after {
      transform: scaleY(1);
    }
    
    .expense-left {
      flex: 1;
    }
    
    .expense-description {
      font-size: 17px;
      font-weight: 600;
      color: var(--color-charcoal);
      margin-bottom: 8px;
    }
    
    .expense-meta {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .expense-date, .expense-payment, .expense-card {
      font-size: 13px;
      color: var(--color-charcoal-light);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .expense-date svg, .expense-payment svg {
      width: 14px;
      height: 14px;
    }
    
    .expense-category {
      background: #FFF4E6;
      color: var(--color-amber);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .expense-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    
    .expense-tag {
      background: var(--color-sage-pale);
      color: var(--color-sage);
      padding: 3px 10px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .expense-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .expense-amount {
      font-family: var(--font-display);
      font-size: 28px;
      font-weight: 700;
      color: var(--color-charcoal);
      letter-spacing: -0.5px;
    }
    
    .expense-delete {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.2s ease;
      opacity: 0.5;
    }
    
    .expense-delete:hover {
      background: #FFE5E5;
      opacity: 1;
    }
    
    .expense-delete svg {
      width: 20px;
      height: 20px;
      stroke: var(--color-red);
    }
    
    .empty-state {
      background: var(--color-white);
      padding: 60px 40px;
      border-radius: 24px;
      text-align: center;
      border: 2px dashed var(--color-border);
    }
    
    .empty-state svg {
      width: 64px;
      height: 64px;
      stroke: var(--color-charcoal-light);
      opacity: 0.3;
      margin-bottom: 16px;
    }
    
    .empty-state p {
      color: var(--color-charcoal-light);
      font-size: 15px;
    }
    
    /* Animations */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 24px 16px;
      }
      
      .header-content h1 {
        font-size: 26px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .form-card, .download-section {
        padding: 28px 24px;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .expense-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      .expense-right {
        width: 100%;
        justify-content: space-between;
      }
      
      .date-range {
        flex-direction: column;
        align-items: stretch;
      }
      
      .date-input {
        min-width: 100%;
      }
      
      .connection-status {
        top: 10px;
        right: 10px;
        font-size: 12px;
        padding: 8px 14px;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Automatically detect if running locally or on deployed server
    const API_URL = window.location.hostname === 'localhost' 
      ? 'http://localhost:3000/api'
      : `${window.location.origin}/api`;

    function ExpenseTracker() {
      const [expenses, setExpenses] = useState([]);
      const [loading, setLoading] = useState(true);
      const [connected, setConnected] = useState(false);
      const [formData, setFormData] = useState({
        description: '',
        amount: '',
        category: 'Food & Dining',
        paymentType: 'Credit Card',
        cardUsed: '',
        tagInput: '',
        tags: []
      });
      const [startDate, setStartDate] = useState('');
      const [endDate, setEndDate] = useState('');

      // Fetch expenses from backend
      useEffect(() => {
        fetchExpenses();
      }, []);

      const fetchExpenses = async () => {
        try {
          const response = await fetch(`${API_URL}/expenses`);
          if (response.ok) {
            const data = await response.json();
            setExpenses(data);
            setConnected(true);
          } else {
            setConnected(false);
          }
        } catch (error) {
          console.error('Error fetching expenses:', error);
          setConnected(false);
        } finally {
          setLoading(false);
        }
      };

      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
      };

      const handleTagKeyPress = (e) => {
        if (e.key === 'Enter' && formData.tagInput.trim()) {
          e.preventDefault();
          if (!formData.tags.includes(formData.tagInput.trim())) {
            setFormData(prev => ({
              ...prev,
              tags: [...prev.tags, formData.tagInput.trim()],
              tagInput: ''
            }));
          }
        }
      };

      const removeTag = (tagToRemove) => {
        setFormData(prev => ({
          ...prev,
          tags: prev.tags.filter(tag => tag !== tagToRemove)
        }));
      };

      const addExpense = async () => {
        if (!formData.description || !formData.amount) {
          alert('Please fill in description and amount');
          return;
        }

        try {
          const response = await fetch(`${API_URL}/expenses`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              description: formData.description,
              amount: parseFloat(formData.amount),
              category: formData.category,
              paymentType: formData.paymentType,
              cardUsed: formData.cardUsed,
              tags: formData.tags
            }),
          });

          if (response.ok) {
            const newExpense = await response.json();
            setExpenses(prev => [newExpense, ...prev]);
            setFormData({
              description: '',
              amount: '',
              category: 'Food & Dining',
              paymentType: 'Credit Card',
              cardUsed: '',
              tagInput: '',
              tags: []
            });
            setConnected(true);
          }
        } catch (error) {
          console.error('Error adding expense:', error);
          alert('Failed to add expense. Please check your connection.');
          setConnected(false);
        }
      };

      const deleteExpense = async (id) => {
        try {
          const response = await fetch(`${API_URL}/expenses/${id}`, {
            method: 'DELETE',
          });

          if (response.ok) {
            setExpenses(prev => prev.filter(exp => exp.id !== id));
            setConnected(true);
          }
        } catch (error) {
          console.error('Error deleting expense:', error);
          alert('Failed to delete expense. Please check your connection.');
          setConnected(false);
        }
      };

      const exportToCSV = () => {
        let filteredExpenses = expenses;

        if (startDate || endDate) {
          filteredExpenses = expenses.filter(exp => {
            const expDate = new Date(exp.date);
            const start = startDate ? new Date(startDate) : new Date(0);
            const end = endDate ? new Date(endDate) : new Date();
            return expDate >= start && expDate <= end;
          });
        }

        const headers = ['Date', 'Description', 'Amount', 'Category', 'Payment Type', 'Card Used', 'Tags'];
        const rows = filteredExpenses.map(exp => [
          new Date(exp.date).toLocaleDateString(),
          exp.description,
          exp.amount.toFixed(2),
          exp.category,
          exp.paymentType,
          exp.cardUsed,
          exp.tags.join('; ')
        ]);

        const csvContent = [
          headers.join(','),
          ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
        ].join('\n');

        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `expenses_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        window.URL.revokeObjectURL(url);
      };

      const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
      const thisMonth = expenses.filter(exp => {
        const expDate = new Date(exp.date);
        const now = new Date();
        return expDate.getMonth() === now.getMonth() && 
               expDate.getFullYear() === now.getFullYear();
      }).reduce((sum, exp) => sum + exp.amount, 0);

      const categoryCount = expenses.reduce((acc, exp) => {
        acc[exp.category] = (acc[exp.category] || 0) + 1;
        return acc;
      }, {});
      const topCategory = Object.entries(categoryCount).sort((a, b) => b[1] - a[1])[0];

      if (loading) {
        return (
          <div className="loading-overlay">
            <div className="spinner"></div>
          </div>
        );
      }

      return (
        <>
          <div className={`connection-status ${connected ? 'connected' : 'disconnected'}`}>
            <span className="status-dot"></span>
            {connected ? 'Database Connected' : 'Database Disconnected'}
          </div>

          <div className="container">
            <div className="header">
              <div className="header-icon">
                <svg fill="none" viewBox="0 0 24 24">
                  <rect x="3" y="6" width="18" height="14" rx="2" strokeLinecap="round" strokeLinejoin="round"/>
                  <path d="M3 10h18" strokeLinecap="round" strokeLinejoin="round"/>
                  <path d="M7 15h.01" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
              </div>
              <div className="header-content">
                <h1>Expense Tracker</h1>
                <p>Track your spending with ease</p>
              </div>
            </div>

            <div className="stats-grid">
              <div className="stat-card">
                <div className="stat-header">
                  <div className="stat-icon green">
                    <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" style={{color: 'var(--color-sage)'}}>
                      <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" strokeLinecap="round" strokeLinejoin="round"/>
                    </svg>
                  </div>
                  <span className="stat-label">Total Expenses</span>
                </div>
                <div className="stat-value">${totalExpenses.toFixed(2)}</div>
              </div>

              <div className="stat-card">
                <div className="stat-header">
                  <div className="stat-icon green">
                    <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" style={{color: 'var(--color-sage)'}}>
                      <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" strokeLinecap="round" strokeLinejoin="round"/>
                    </svg>
                  </div>
                  <span className="stat-label">This Month</span>
                </div>
                <div className="stat-value">${thisMonth.toFixed(2)}</div>
              </div>

              <div className="stat-card">
                <div className="stat-header">
                  <div className="stat-icon green">
                    <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" style={{color: 'var(--color-sage)'}}>
                      <rect x="3" y="6" width="18" height="14" rx="2" strokeLinecap="round" strokeLinejoin="round"/>
                      <path d="M3 10h18" strokeLinecap="round" strokeLinejoin="round"/>
                    </svg>
                  </div>
                  <span className="stat-label">Transactions</span>
                </div>
                <div className="stat-value">{expenses.length}</div>
              </div>

              <div className="stat-card">
                <div className="stat-header">
                  <div className="stat-icon amber">
                    <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" style={{color: 'var(--color-amber)'}}>
                      <path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" strokeLinecap="round" strokeLinejoin="round"/>
                      <path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z" strokeLinecap="round" strokeLinejoin="round"/>
                    </svg>
                  </div>
                  <span className="stat-label">Top Category</span>
                </div>
                <div className="stat-value" style={{fontSize: '24px'}}>{topCategory ? topCategory[0] : 'N/A'}</div>
              </div>
            </div>

            <div className="form-card">
              <h2>Add New Expense</h2>
              <div className="form-grid">
                <div className="form-group">
                  <label>Item / Description</label>
                  <input
                    type="text"
                    name="description"
                    placeholder="e.g., Lunch at restaurant"
                    value={formData.description}
                    onChange={handleInputChange}
                  />
                </div>
                <div className="form-group">
                  <label>Amount</label>
                  <input
                    type="number"
                    name="amount"
                    placeholder="0.00"
                    step="0.01"
                    value={formData.amount}
                    onChange={handleInputChange}
                  />
                </div>
                <div className="form-group">
                  <label>Category</label>
                  <select name="category" value={formData.category} onChange={handleInputChange}>
                    <option>Food & Dining</option>
                    <option>Transportation</option>
                    <option>Shopping</option>
                    <option>Entertainment</option>
                    <option>Bills & Utilities</option>
                    <option>Healthcare</option>
                    <option>Travel</option>
                    <option>Other</option>
                  </select>
                </div>
                <div className="form-group">
                  <label>Payment Type</label>
                  <select name="paymentType" value={formData.paymentType} onChange={handleInputChange}>
                    <option>Credit Card</option>
                    <option>Debit Card</option>
                    <option>Cash</option>
                    <option>Digital Wallet</option>
                    <option>Bank Transfer</option>
                  </select>
                </div>
                <div className="form-group">
                  <label>Card Used</label>
                  <input
                    type="text"
                    name="cardUsed"
                    placeholder="e.g., Visa ending 4242"
                    value={formData.cardUsed}
                    onChange={handleInputChange}
                  />
                </div>
                <div className="form-group">
                  <label>Tags</label>
                  <div className="tag-input-wrapper">
                    <input
                      type="text"
                      name="tagInput"
                      placeholder="Add tag & press Enter"
                      value={formData.tagInput}
                      onChange={handleInputChange}
                      onKeyPress={handleTagKeyPress}
                    />
                    {formData.tags.length > 0 && (
                      <div className="tags-display">
                        {formData.tags.map(tag => (
                          <span key={tag} className="tag">
                            {tag}
                            <span className="tag-remove" onClick={() => removeTag(tag)}>×</span>
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>
              <button className="btn btn-primary" onClick={addExpense} disabled={!connected}>
                <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                  <path d="M12 5v14M5 12h14" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
                Add Expense
              </button>
            </div>

            <div className="download-section">
              <h2>Download Statement</h2>
              <div className="date-range">
                <div className="date-input">
                  <label>Start Date</label>
                  <input
                    type="date"
                    value={startDate}
                    onChange={(e) => setStartDate(e.target.value)}
                  />
                </div>
                <div className="date-input">
                  <label>End Date</label>
                  <input
                    type="date"
                    value={endDate}
                    onChange={(e) => setEndDate(e.target.value)}
                  />
                </div>
                <button className="btn btn-secondary" onClick={exportToCSV}>
                  <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" strokeLinecap="round" strokeLinejoin="round"/>
                  </svg>
                  Export CSV
                </button>
              </div>
            </div>

            <div className="expenses-section">
              <div className="expenses-header">
                <h2>Recent Expenses</h2>
                <span className="expense-count">{expenses.length}</span>
              </div>
              {expenses.length === 0 ? (
                <div className="empty-state">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M9 12h6M9 16h6M9 8h6M5 20h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z" strokeLinecap="round" strokeLinejoin="round"/>
                  </svg>
                  <p>No expenses yet. Add your first expense to get started!</p>
                </div>
              ) : (
                <div className="expenses-list">
                  {expenses.map(expense => (
                    <div key={expense.id} className="expense-item">
                      <div className="expense-left">
                        <div className="expense-description">{expense.description}</div>
                        <div className="expense-meta">
                          <span className="expense-date">
                            <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" strokeLinecap="round" strokeLinejoin="round"/>
                              <path d="M16 2v4M8 2v4M3 10h18" strokeLinecap="round" strokeLinejoin="round"/>
                            </svg>
                            {new Date(expense.date).toLocaleDateString('en-US', { 
                              month: 'short', 
                              day: 'numeric', 
                              year: 'numeric' 
                            })}
                          </span>
                          <span className="expense-payment">
                            <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                              <rect x="3" y="6" width="18" height="14" rx="2" strokeLinecap="round" strokeLinejoin="round"/>
                              <path d="M3 10h18" strokeLinecap="round" strokeLinejoin="round"/>
                            </svg>
                            {expense.paymentType}
                          </span>
                          {expense.cardUsed && (
                            <span className="expense-card">• {expense.cardUsed}</span>
                          )}
                          <span className="expense-category">{expense.category}</span>
                          {expense.tags.length > 0 && (
                            <div className="expense-tags">
                              {expense.tags.map(tag => (
                                <span key={tag} className="expense-tag">{tag}</span>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                      <div className="expense-right">
                        <div className="expense-amount">${expense.amount.toFixed(2)}</div>
                        <button className="expense-delete" onClick={() => deleteExpense(expense.id)} disabled={!connected}>
                          <svg fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" strokeLinecap="round" strokeLinejoin="round"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </>
      );
    }

    ReactDOM.render(<ExpenseTracker />, document.getElementById('root'));
    
    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then((registration) => {
            console.log('Service Worker registered:', registration);
          })
          .catch((error) => {
            console.log('Service Worker registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>